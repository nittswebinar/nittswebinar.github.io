var sessionService=angular.module("nittsAppSessions",["ngCookies","nittsAlert"]);sessionService.service("Session",["$http","$cookies","alerts",function(e,t,s){var n="https://www.app.nittswebinar.com",r=n+"/auth",i={attendee:t.getObject("attendee")||{},user:t.getObject("user")||{},accessToken:t.getObject("accessToken")||null};this.isAuthenticated=function(){return!(!i.user||!i.user.id)},this.getAccessToken=function(){return i.accessToken},this.setAccessToken=function(e){return i.accessToken=e,t.putObject("accessToken",e),i.accessToken},this.getUser=function(){return i.user},this.setUser=function(e){return i.user=e,t.putObject("user",e),i.user},this.setAttendee=function(e){return i.attendee=e,t.putObject("attendee",e),i.attendee},this.destroy=function(){this.setUser({}),this.setAccessToken(null)},this.checkIfAuthenticated=function(t){var t=t||function(){},r=this;return this.isAuthenticated()?void e({method:"GET",url:n+"/user/"+i.user.id,headers:{Authorization:"Bearer "+this.getAccessToken()}}).then(function(e){return r.setUser(e.data),t()},function(e){return r.destroy(),t()}):(r.destroy(),s.add({type:"warning",message:"Vous n'êtes pas authentifié. Veuillez vous connecter. "}),t())},this.getScopeData=function(){return i},this.login=function(t,n){var n=n||function(){},i=this;e.post(r+"/local",{identifier:t.email,password:t.password}).then(function(e){var s=e.data;return mixpanel.identify(e.data.session.passport.user),mixpanel.people.set({$email:t.email,$last_login:new Date}),i.setUser(s.user),i.setAccessToken(s.accessToken),n()},function(e){var t=e.data?e.data.message:"";return s.add({type:"danger",message:"Une erreur est survenue pendant la connexion : "+t}),n()})},this.register=function(t,n){var n=n||function(){},i=this;e.post(r+"/local/register",{identifier:t.email,password:t.password}).then(function(e){var s=e.data;return mixpanel.track("Register process successful"),mixpanel.alias(e.data.session.passport.user),mixpanel.people.set({$email:t.email,$created:new Date,$last_login:new Date}),i.setUser(s.user),i.setAccessToken(s.accessToken),n()},function(e){return s.add({type:"warning",message:"Une erreur est survenue pendant la création du compte. Veuillez réessayer. "+e.data.message}),n()})},this.logout=function(t){var t=t||function(){},r=this;e({method:"GET",url:n+"/logout",headers:{Authorization:"Bearer "+this.getAccessToken()}}).then(function(e){return r.destroy(),t()},function(e){return s.add({type:"warning",message:"Une erreur est survenue pendant la deconnexion"}),t()})},this.forgot=function(t,n){n=n||function(){},e.post(r+"/forgot",{email:t}).then(function(e){s.add({type:"success",message:"Un email vient de vous être envoyé pour réinitialiser votre mot de passe."}),n()},function(e){s.add({type:"danger",message:"Problème de réinitialisation de mot de passe : "+e.data.message}),n()})}}]);